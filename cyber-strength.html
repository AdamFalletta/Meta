<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Strength: Weekly Fitness Log</title>
    <style>
        /* Same styles as before */
        /* Additional styling for table interactivity */
        table tr {
            cursor: pointer;
        }

        table tr:hover {
            background-color: #444;
        }

        .popup {
            /* Keep the previous popup styles */
        }
    </style>
</head>
<body>
    <header>
        <h1>Cyber Strength</h1>
        <div class="date-display"></div>
    </header>
    <div class="week-controls">
        <button id="prev-week">Previous Week</button>
        <button id="next-week">Next Week</button>
    </div>
    <div class="content" id="content"></div>

    <div class="popup" id="popup">
        <div class="popup-content">
            <h3 id="popup-title">Add/Edit Workout</h3>
            <input type="text" id="exercise" placeholder="Exercise">
            <input type="number" id="weight" placeholder="Weight">
            <input type="number" id="sets" placeholder="Sets">
            <input type="number" id="reps" placeholder="Reps">
            <div class="popup-buttons">
                <button class="save" id="save-workout">Save</button>
                <button class="delete" id="delete-workout" style="display: none;">Delete</button>
                <button class="cancel" id="cancel-workout">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
        let currentDate = new Date();
        let currentWeekStart;
        let currentEditDayIndex = null;
        let currentEditWorkoutIndex = null;

        const content = document.getElementById('content');
        const popup = document.getElementById('popup');
        const dateDisplay = document.querySelector('.date-display');

        const exerciseInput = document.getElementById('exercise');
        const weightInput = document.getElementById('weight');
        const setsInput = document.getElementById('sets');
        const repsInput = document.getElementById('reps');

        const saveWorkoutBtn = document.getElementById('save-workout');
        const deleteWorkoutBtn = document.getElementById('delete-workout');
        const cancelWorkoutBtn = document.getElementById('cancel-workout');

        function initialize() {
            calculateWeekStart();
            updateWeekDisplay();
            renderDays();
        }

        function calculateWeekStart() {
            const dayOffset = currentDate.getDay() || 7;
            currentWeekStart = new Date(currentDate);
            currentWeekStart.setDate(currentDate.getDate() - (dayOffset - 1));
        }

        function updateWeekDisplay() {
            const month = currentWeekStart.toLocaleString('default', { month: 'long' });
            const year = currentWeekStart.getFullYear();
            dateDisplay.textContent = `${month} ${year}`;
        }

        function renderDays() {
            content.innerHTML = "";
            days.forEach((day, index) => {
                const column = document.createElement('div');
                column.className = 'day-column';

                const header = document.createElement('div');
                header.className = 'day-header';
                header.textContent = day;

                const table = document.createElement('table');
                table.addEventListener('click', (event) => {
                    const rowIndex = [...event.target.parentNode.parentNode.children].indexOf(event.target.parentNode);
                    openPopup(index, rowIndex);
                });

                const thead = document.createElement('thead');
                const tr = document.createElement('tr');
                ["Exercise", "Weight", "Sets", "Reps"].forEach(headerText => {
                    const th = document.createElement('th');
                    th.textContent = headerText;
                    tr.appendChild(th);
                });
                thead.appendChild(tr);
                table.appendChild(thead);

                const tbody = document.createElement('tbody');
                tbody.id = `workout-data-${index}`;
                table.appendChild(tbody);

                column.appendChild(header);
                column.appendChild(table);
                content.appendChild(column);

                renderWorkouts(index);
            });
        }

        function openPopup(dayIndex, workoutIndex = null) {
            currentEditDayIndex = dayIndex;
            currentEditWorkoutIndex = workoutIndex;

            const workouts = getWorkouts(dayIndex);
            if (workoutIndex !== null && workouts[workoutIndex]) {
                const workout = workouts[workoutIndex];
                exerciseInput.value = workout.exercise;
                weightInput.value = workout.weight;
                setsInput.value = workout.sets;
                repsInput.value = workout.reps;
                deleteWorkoutBtn.style.display = 'block';
                document.getElementById('popup-title').textContent = 'Edit Workout';
            } else {
                exerciseInput.value = '';
                weightInput.value = '';
                setsInput.value = '';
                repsInput.value = '';
                deleteWorkoutBtn.style.display = 'none';
                document.getElementById('popup-title').textContent = 'Add Workout';
            }

            popup.classList.add('active');
        }

        function closePopup() {
            popup.classList.remove('active');
            currentEditDayIndex = null;
            currentEditWorkoutIndex = null;
        }

        function saveWorkout() {
            const workout = {
                exercise: exerciseInput.value,
                weight: parseInt(weightInput.value),
                sets: parseInt(setsInput.value),
                reps: parseInt(repsInput.value),
            };

            const workouts = getWorkouts(currentEditDayIndex);
            if (currentEditWorkoutIndex !== null) {
                workouts[currentEditWorkoutIndex] = workout;
            } else {
                workouts.push(workout);
            }

            saveWorkouts(currentEditDayIndex, workouts);
            renderWorkouts(currentEditDayIndex);
            closePopup();
        }

        function deleteWorkout() {
            const workouts = getWorkouts(currentEditDayIndex);
            if (currentEditWorkoutIndex !== null) {
                workouts.splice(currentEditWorkoutIndex, 1);
                saveWorkouts(currentEditDayIndex, workouts);
                renderWorkouts(currentEditDayIndex);
            }
            closePopup();
        }

        function getWorkouts(dayIndex) {
            const weekKey = currentWeekStart.toISOString();
            const weekData = JSON.parse(localStorage.getItem(weekKey)) || {};
            return weekData[dayIndex] || [];
        }

        function saveWorkouts(dayIndex, workouts) {
            const weekKey = currentWeekStart.toISOString();
            const weekData = JSON.parse(localStorage.getItem(weekKey)) || {};
            weekData[dayIndex] = workouts;
            localStorage.setItem(weekKey, JSON.stringify(weekData));
        }

        function renderWorkouts(dayIndex) {
            const workouts = getWorkouts(dayIndex);
            const tbody = document.getElementById(`workout-data-${dayIndex}`);
            tbody.innerHTML = "";
            workouts.forEach((workout, index) => {
                const tr = document.createElement('tr');
                ["exercise", "weight", "sets", "reps"].forEach(key => {
                    const td = document.createElement('td');
                    td.textContent = workout[key];
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        document.getElementById('prev-week').addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() - 7);
            initialize();
        });

        document.getElementById('next-week').addEventListener('click', () => {
            currentDate.setDate(currentDate.getDate() + 7);
            initialize();
        });

        saveWorkoutBtn.addEventListener('click', saveWorkout);
        deleteWorkoutBtn.addEventListener('click', deleteWorkout);
        cancelWorkoutBtn.addEventListener('click', closePopup);

        initialize();
    </script>
</body>
</html>
