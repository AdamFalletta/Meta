<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RevV Radio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --accent: #1DB954;
            --bg-dark: #050505;
            --header-h: 70px;
            --footer-h: 80px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: #ffffff;
            height: 100vh;
            width: 100vw;
            margin: 0;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        #app-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            position: relative;
        }

        header {
            height: var(--header-h);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            z-index: 60;
            background: var(--bg-dark);
        }

        nav {
            height: var(--footer-h);
            background: rgba(18, 18, 18, 0.98);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 60;
            padding-bottom: env(safe-area-inset-bottom);
        }

        main {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .page {
            position: absolute;
            inset: 0;
            overflow-y: auto;
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 10;
            background: var(--bg-dark);
            -webkit-overflow-scrolling: touch;
        }

        .page-hidden {
            opacity: 0;
            transform: scale(0.98);
            pointer-events: none;
            z-index: 0;
        }

        #page-player {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
        }

        .player-art-container {
            width: 80%;
            max-width: 300px;
            aspect-ratio: 1/1;
            margin-bottom: 2.5rem;
            border-radius: 2rem;
            overflow: hidden;
            box-shadow: 0 40px 80px rgba(0,0,0,0.9);
            transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .playing-pulse { transform: scale(1.04); }

        #visualizer-view {
            position: fixed;
            inset: 0;
            z-index: 100;
            background: #000;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #visualizer-view.active { transform: translateY(0%); }

        input[type='range'] {
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
            width: 100%;
        }

        input[type='range']::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
        }

        .active-tab-icon { color: var(--accent); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="app-container">
        
        <header id="app-header">
            <h1 class="text-xl font-bold tracking-tight">RevV Radio</h1>
            <button id="visualizer-toggle" class="w-10 h-10 flex items-center justify-center text-white/40 hover:text-white transition-colors">
                <i class="fas fa-bars-staggered"></i>
            </button>
        </header>

        <main>
            <section id="page-home" class="page p-6">
                <div class="mb-8">
                    <h2 class="text-gray-400 text-[10px] font-bold uppercase tracking-widest mb-1">Explore</h2>
                    <h3 class="text-2xl font-bold">Today's Picks</h3>
                </div>
                <div class="grid grid-cols-2 gap-3 mb-8" id="home-grid"></div>
                <h2 class="text-lg font-bold mb-4">Trending</h2>
                <div class="flex space-x-4 overflow-x-auto pb-4 no-scrollbar" id="discover-list"></div>
            </section>

            <section id="page-library" class="page page-hidden p-6">
                <div class="mb-6">
                    <h1 class="text-2xl font-bold">Track Library</h1>
                </div>
                <div class="space-y-1" id="library-list"></div>
            </section>

            <section id="page-player" class="page page-hidden">
                <div class="player-art-container" id="art-box">
                    <img id="main-art" src="" class="w-full h-full object-cover">
                </div>
                
                <div class="w-full max-w-sm mb-6">
                    <h2 id="main-title" class="text-3xl font-bold truncate px-6">Not Playing</h2>
                    <p id="main-artist" class="text-lg text-white/40 truncate px-6">Select a track to start</p>
                </div>

                <div class="w-full max-w-sm px-8 mb-8">
                    <input type="range" id="seek-bar" value="0" step="0.1" class="appearance-none mb-2">
                    <div class="flex justify-between text-[11px] font-medium text-white/30">
                        <span id="cur-time">0:00</span>
                        <span id="dur-time">0:00</span>
                    </div>
                </div>

                <div class="w-full max-w-sm flex justify-between items-center px-10">
                    <button class="text-white/20 text-lg"><i class="fas fa-shuffle"></i></button>
                    <button onclick="radio.prev()" class="text-2xl active:scale-90"><i class="fas fa-backward-step"></i></button>
                    <button id="play-btn" onclick="radio.toggle()" class="w-20 h-20 bg-white text-black rounded-full flex items-center justify-center text-3xl shadow-2xl active:scale-90">
                        <i id="play-btn-icon" class="fas fa-play ml-1"></i>
                    </button>
                    <button onclick="radio.next()" class="text-2xl active:scale-90"><i class="fas fa-forward-step"></i></button>
                    <button class="text-white/20 text-lg"><i class="fas fa-repeat"></i></button>
                </div>
            </section>
        </main>

        <div id="mini-player" class="fixed bottom-24 left-4 right-4 h-16 bg-[#111] border border-white/10 rounded-2xl z-50 flex items-center px-4 cursor-pointer hidden shadow-2xl active:scale-[0.98] transition-all" onclick="changeTab('player')">
            <img id="mini-img" src="" class="w-10 h-10 rounded-lg object-cover mr-4">
            <div class="flex-1 min-w-0">
                <p id="mini-t" class="text-sm font-bold truncate">Title</p>
                <p id="mini-a" class="text-[10px] text-white/40 uppercase font-bold tracking-wider">Artist</p>
            </div>
            <button onclick="event.stopPropagation(); radio.toggle();" class="w-12 h-12 flex items-center justify-center text-xl">
                <i id="mini-play-icon" class="fas fa-play"></i>
            </button>
        </div>

        <nav>
            <button onclick="changeTab('home')" class="nav-btn flex flex-col items-center space-y-1 active-tab-icon" data-tab="home">
                <i class="fas fa-house-chimney text-xl"></i>
                <span class="text-[10px] font-bold uppercase">Home</span>
            </button>
            <button onclick="changeTab('library')" class="nav-btn flex flex-col items-center space-y-1 text-white/40" data-tab="library">
                <i class="fas fa-compact-disc text-xl"></i>
                <span class="text-[10px] font-bold uppercase">Library</span>
            </button>
            <button onclick="changeTab('player')" class="nav-btn flex flex-col items-center space-y-1 text-white/40" data-tab="player">
                <i class="fas fa-waveform text-xl"></i>
                <span class="text-[10px] font-bold uppercase">Player</span>
            </button>
        </nav>

        <div id="visualizer-view">
            <canvas id="viz-canvas" class="absolute inset-0 w-full h-full"></canvas>
            <div class="absolute bottom-12 left-0 right-0 p-8 flex flex-col pointer-events-none">
                <h2 id="viz-t" class="text-5xl font-black mb-1 truncate">Title</h2>
                <p id="viz-a" class="text-xl text-white/50 mb-10">Artist</p>
                <div class="flex items-center space-x-6 pointer-events-auto">
                    <button onclick="radio.toggle()" class="w-16 h-16 rounded-full bg-white text-black flex items-center justify-center text-xl">
                        <i id="viz-play-icon" class="fas fa-play"></i>
                    </button>
                    <button id="exit-viz" class="px-6 py-3 rounded-full bg-white/10 border border-white/20 text-[10px] font-bold uppercase tracking-widest text-white">Close Canvas</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        const SONGS = [
            { id: 1, title: "Stable Test", artist: "W3Schools", color: "#1DB954", cover: "https://images.unsplash.com/photo-1553284965-83fd3e82fa5a?w=500", url: "https://www.w3schools.com/html/horse.mp3" },
            { id: 2, title: "Midnight Drift", artist: "Helix", color: "#00d2ff", cover: "https://images.unsplash.com/photo-1493225255756-d9584f8606e9?w=500", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" },
            { id: 3, title: "Neon Skyline", artist: "Helix", color: "#ff0080", cover: "https://images.unsplash.com/photo-1514525253344-09848520977d?w=500", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" }
        ];

        class RevVRadio {
            constructor() {
                this.audio = new Audio();
                this.audio.crossOrigin = "anonymous";
                this.index = -1;
                this.isPlaying = false;
                this.ctx = null;
                this.analyser = null;
                this.data = null;
                this.initListeners();
            }

            async initAudioContext() {
                if (this.ctx) return;
                try {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    this.analyser = this.ctx.createAnalyser();
                    const source = this.ctx.createMediaElementSource(this.audio);
                    source.connect(this.analyser);
                    this.analyser.connect(this.ctx.destination);
                    this.analyser.fftSize = 128;
                    this.data = new Uint8Array(this.analyser.frequencyBinCount);
                } catch(e) { console.warn("Visualizer context blocked."); }
            }

            initListeners() {
                this.audio.addEventListener('timeupdate', () => {
                    if(!isNaN(this.audio.duration)) {
                        const prog = (this.audio.currentTime / this.audio.duration) * 100;
                        document.getElementById('seek-bar').value = prog;
                        document.getElementById('cur-time').innerText = this.formatTime(this.audio.currentTime);
                        document.getElementById('dur-time').innerText = this.formatTime(this.audio.duration);
                    }
                });
                this.audio.addEventListener('play', () => { this.isPlaying = true; this.updateUI(); });
                this.audio.addEventListener('pause', () => { this.isPlaying = false; this.updateUI(); });
                this.audio.addEventListener('ended', () => this.next());
                this.audio.addEventListener('error', (e) => {
                    console.error("Audio Error:", e);
                });
            }

            formatTime(s) { return Math.floor(s/60) + ":" + Math.floor(s%60).toString().padStart(2, '0'); }

            async playSong(idx) {
                changeTab('player');
                
                if (this.index === idx && this.audio.src) {
                    this.toggle();
                    return;
                }

                this.index = idx;
                const song = SONGS[this.index];
                
                this.audio.pause();
                this.audio.src = song.url;
                this.audio.load();
                
                this.updateUI();
                
                await this.initAudioContext();
                if (this.ctx && this.ctx.state === 'suspended') await this.ctx.resume();
                
                try {
                    setTimeout(() => {
                        this.audio.play().catch(err => console.warn("Playback blocked by browser interaction policy."));
                    }, 100);
                } catch(e) {}
            }

            async toggle() {
                if (!this.audio.src) {
                    this.playSong(0);
                    return;
                }

                await this.initAudioContext();
                if (this.ctx && this.ctx.state === 'suspended') await this.ctx.resume();

                if (this.isPlaying) this.audio.pause();
                else {
                    try { await this.audio.play(); } catch(e) {}
                }
            }

            next() { this.playSong((this.index + 1) % SONGS.length); }
            prev() { this.playSong((this.index - 1 + SONGS.length) % SONGS.length); }

            updateUI() {
                if (this.index === -1) return;
                const s = SONGS[this.index];
                const icon = this.isPlaying ? 'fa-pause' : 'fa-play';
                
                document.getElementById('main-title').innerText = s.title;
                document.getElementById('main-artist').innerText = s.artist;
                document.getElementById('main-art').src = s.cover;
                document.getElementById('play-btn-icon').className = `fas ${icon} ${this.isPlaying ? '' : 'ml-1'}`;
                
                const mini = document.getElementById('mini-player');
                mini.classList.remove('hidden');
                document.getElementById('mini-t').innerText = s.title;
                document.getElementById('mini-a').innerText = s.artist;
                document.getElementById('mini-img').src = s.cover;
                document.getElementById('mini-play-icon').className = `fas ${icon}`;

                document.getElementById('viz-t').innerText = s.title;
                document.getElementById('viz-a').innerText = s.artist;
                document.getElementById('viz-play-icon').className = `fas ${icon}`;

                const box = document.getElementById('art-box');
                if(this.isPlaying) box.classList.add('playing-pulse');
                else box.classList.remove('playing-pulse');
            }
        }

        const radio = new RevVRadio();

        function changeTab(tabId) {
            document.querySelectorAll('.page').forEach(p => {
                p.classList.toggle('page-hidden', p.id !== `page-${tabId}`);
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.toggle('active-tab-icon', btn.dataset.tab === tabId);
                if (btn.dataset.tab !== tabId) btn.classList.add('text-white/40');
                else btn.classList.remove('text-white/40');
            });
            
            const header = document.getElementById('app-header');
            const mini = document.getElementById('mini-player');
            
            if(tabId === 'player') {
                header.classList.add('opacity-0', 'pointer-events-none');
                mini.classList.add('opacity-0', 'pointer-events-none');
            } else {
                header.classList.remove('opacity-0', 'pointer-events-none');
                if(radio.index !== -1) {
                    mini.classList.remove('opacity-0', 'pointer-events-none');
                }
            }
        }

        const canvas = document.getElementById('viz-canvas');
        const vctx = canvas.getContext('2d');
        let vFrame;

        function render() {
            vFrame = requestAnimationFrame(render);
            if(!radio.analyser) return;
            radio.analyser.getByteFrequencyData(radio.data);
            
            vctx.fillStyle = 'rgba(0,0,0,0.1)';
            vctx.fillRect(0, 0, canvas.width, canvas.height);

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const s = SONGS[radio.index] || {color: '#ffffff'};

            for(let i=0; i<radio.data.length; i++) {
                const val = radio.data[i];
                const angle = (i / radio.data.length) * Math.PI * 2;
                const r = (canvas.width * 0.18) + (val * 1.1);
                const x = centerX + Math.cos(angle) * r;
                const y = centerY + Math.sin(angle) * r;

                vctx.strokeStyle = s.color;
                vctx.globalAlpha = val / 255;
                vctx.lineWidth = 4;
                vctx.beginPath();
                vctx.moveTo(centerX, centerY);
                vctx.lineTo(x, y);
                vctx.stroke();
            }
        }

        document.getElementById('visualizer-toggle').onclick = () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            document.getElementById('visualizer-view').classList.add('active');
            radio.initAudioContext();
            render();
        };

        document.getElementById('exit-viz').onclick = () => {
            document.getElementById('visualizer-view').classList.remove('active');
            cancelAnimationFrame(vFrame);
        };

        document.getElementById('seek-bar').oninput = (e) => {
            if(radio.audio.duration) {
                radio.audio.currentTime = (e.target.value / 100) * radio.audio.duration;
            }
        };

        window.onload = () => {
            const hg = document.getElementById('home-grid');
            const dl = document.getElementById('discover-list');
            const ll = document.getElementById('library-list');

            SONGS.forEach((s, i) => {
                hg.innerHTML += `<div onclick="radio.playSong(${i})" class="bg-white/5 p-3 rounded-2xl flex items-center space-x-4 active:bg-white/10 cursor-pointer transition-all"><img src="${s.cover}" class="w-12 h-12 rounded-xl object-cover shadow-lg"><span class="text-xs font-bold truncate uppercase tracking-tight">${s.title}</span></div>`;
                dl.innerHTML += `<div onclick="radio.playSong(${i})" class="min-w-[160px] cursor-pointer active:scale-95 transition-transform"><img src="${s.cover}" class="w-full aspect-square rounded-2xl object-cover mb-3 shadow-2xl"><p class="text-sm font-bold truncate">${s.title}</p><p class="text-[11px] text-white/40 font-medium">${s.artist}</p></div>`;
                ll.innerHTML += `<div onclick="radio.playSong(${i})" class="flex items-center p-4 rounded-2xl active:bg-white/5 cursor-pointer"><img src="${s.cover}" class="w-14 h-14 rounded-xl mr-5 object-cover shadow-lg"><div class="flex-1 min-w-0"><p class="font-bold text-base truncate">${s.title}</p><p class="text-[11px] text-white/40 uppercase font-bold tracking-wider">${s.artist}</p></div><i class="fas fa-play text-xs text-white/10"></i></div>`;
            });
            
            radio.index = 0;
            radio.updateUI();
            radio.index = -1;
        };
    </script>
</body>
</html>
